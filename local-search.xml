<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>SPI,IIC,UARTå¯¹æ¯”</title>
    <link href="/2025/04/15/20250416/"/>
    <url>/2025/04/15/20250416/</url>
    
    <content type="html"><![CDATA[<h1 id="I2Cã€SPIå’ŒUARTä¸²è¡Œé€šä¿¡åè®®å¯¹æ¯”"><a href="#I2Cã€SPIå’ŒUARTä¸²è¡Œé€šä¿¡åè®®å¯¹æ¯”" class="headerlink" title="I2Cã€SPIå’ŒUARTä¸²è¡Œé€šä¿¡åè®®å¯¹æ¯”"></a>I2Cã€SPIå’ŒUARTä¸²è¡Œé€šä¿¡åè®®å¯¹æ¯”</h1><h2 id="1-I2Cé€šä¿¡"><a href="#1-I2Cé€šä¿¡" class="headerlink" title="1. I2Cé€šä¿¡"></a>1. <strong>I2Cé€šä¿¡</strong></h2><h3 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul><li><strong>å¤šä¸»æœºå’Œå¤šä»æœº</strong>  </li><li><strong>ä¸¤æ ¹çº¿</strong>ï¼šSDAï¼ˆæ•°æ®çº¿ï¼‰å’ŒSCLï¼ˆæ—¶é’Ÿçº¿ï¼‰  </li><li><strong>é€šä¿¡é€Ÿç‡</strong>ï¼š100kbpsï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰è‡³3.4Mbpsï¼ˆé«˜é€Ÿæ¨¡å¼ï¼‰  </li><li><strong>åœ°å€æ¨¡å¼</strong>ï¼š7ä½æˆ–10ä½è®¾å¤‡åœ°å€</li></ul><h3 id="é€šä¿¡æ—¶åºï¼š"><a href="#é€šä¿¡æ—¶åºï¼š" class="headerlink" title="é€šä¿¡æ—¶åºï¼š"></a>é€šä¿¡æ—¶åºï¼š</h3><ol><li><strong>èµ·å§‹ä¿¡å·</strong>ï¼šSDAä»é«˜ç”µå¹³æ‹‰ä½ï¼ˆSCLä¿æŒé«˜ç”µå¹³ï¼‰  </li><li><strong>è®¾å¤‡åœ°å€</strong>ï¼šå‘é€7ä½åœ°å€ + è¯»å†™ä½ï¼ˆ0å†™&#x2F;1è¯»ï¼‰  </li><li><strong>æ•°æ®ä¼ è¾“</strong>ï¼šæ¯å­—èŠ‚åæ¥æ”¶æ–¹è¿”å›ACK&#x2F;NACK  </li><li><strong>åœæ­¢ä¿¡å·</strong>ï¼šSDAä»ä½ç”µå¹³æ‹‰é«˜ï¼ˆSCLä¿æŒé«˜ç”µå¹³ï¼‰</li></ol><h4 id="æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12åˆ°åœ°å€0x50ï¼‰ï¼š"><a href="#æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12åˆ°åœ°å€0x50ï¼‰ï¼š" class="headerlink" title="æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12åˆ°åœ°å€0x50ï¼‰ï¼š"></a>æ—¶åºç¤ºä¾‹ï¼ˆå‘é€<code>0x12</code>åˆ°åœ°å€<code>0x50</code>ï¼‰ï¼š</h4><p>æ—¶é—´  0      1     2   3  4   5   6   7  8   9  10  11  12  13<br>       __    __   __  __  __  __  __  __  __  __  __  __<br>SDA  |  S  |  0  |  1  |  0  |  1  |  0  |  1  |  0  |  1  |  0  |  1 |  0 |  P<br>        â†‘    â†“     â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†“ â†‘<br>SCL  â€”â€“ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘ â†‘</p><ul><li><strong>S</strong>ï¼šèµ·å§‹æ¡ä»¶  </li><li><strong>P</strong>ï¼šåœæ­¢æ¡ä»¶</li></ul><h3 id="åˆå§‹åŒ–æ­¥éª¤ï¼š"><a href="#åˆå§‹åŒ–æ­¥éª¤ï¼š" class="headerlink" title="åˆå§‹åŒ–æ­¥éª¤ï¼š"></a>åˆå§‹åŒ–æ­¥éª¤ï¼š</h3><ol><li>é…ç½®SDAå’ŒSCLä¸ºæ¨æŒ½è¾“å‡º  </li><li>è®¾ç½®æ—¶é’Ÿé¢‘ç‡ï¼ˆå¦‚100kHzï¼‰  </li><li>é…ç½®è®¾å¤‡åœ°å€å’Œè¯»&#x2F;å†™æ¨¡å¼</li></ol><hr><h2 id="2-SPIé€šä¿¡"><a href="#2-SPIé€šä¿¡" class="headerlink" title="2. SPIé€šä¿¡"></a>2. <strong>SPIé€šä¿¡</strong></h2><h3 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul><li><strong>å…¨åŒå·¥é€šä¿¡</strong>  </li><li><strong>å››æ ¹çº¿</strong>ï¼šMISOã€MOSIã€SCLKã€SS  </li><li><strong>é€Ÿç‡</strong>ï¼šå¯è¾¾å‡ Mbps  </li><li><strong>æ—¶é’Ÿæ§åˆ¶</strong>ï¼šä¸»è®¾å¤‡ç”Ÿæˆæ—¶é’Ÿ</li></ul><h3 id="é€šä¿¡æ—¶åºï¼š-1"><a href="#é€šä¿¡æ—¶åºï¼š-1" class="headerlink" title="é€šä¿¡æ—¶åºï¼š"></a>é€šä¿¡æ—¶åºï¼š</h3><ol><li><strong>èµ·å§‹</strong>ï¼šSSæ‹‰ä½é€‰æ‹©ä»æœº  </li><li><strong>æ—¶é’ŸåŒæ­¥</strong>ï¼šSCLKç”±ä¸»æœºæ§åˆ¶ï¼ˆCPOL&#x2F;CPHAé…ç½®è¾¹æ²¿ï¼‰  </li><li><strong>æ•°æ®ä¼ è¾“</strong>ï¼šMOSIå‘é€æ•°æ®ï¼ŒMISOæ¥æ”¶æ•°æ®  </li><li><strong>åœæ­¢</strong>ï¼šSSæ‹‰é«˜</li></ol><h4 id="æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12ï¼ŒCPOL-0-CPHA-0ï¼‰ï¼š"><a href="#æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12ï¼ŒCPOL-0-CPHA-0ï¼‰ï¼š" class="headerlink" title="æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12ï¼ŒCPOL&#x3D;0, CPHA&#x3D;0ï¼‰ï¼š"></a>æ—¶åºç¤ºä¾‹ï¼ˆå‘é€<code>0x12</code>ï¼ŒCPOL&#x3D;0, CPHA&#x3D;0ï¼‰ï¼š</h4><p>æ—¶é—´  0    1  2  3  4   5   6   7   8   9   10<br>SCLK  â€“|â€“|â€“|â€“|â€“|â€“|â€“|â€“|â€“|â€“|â€“|â€“<br>MOSI   | 0  1  0  0  1  0  0  1  0  1 | (å‘é€æ•°æ®)<br>MISO   |     |  (æ¥æ”¶æ•°æ®)<br>SS     |â€”|â€”â€”â€”â€”â€”â€”â€“|â€”|  (é€‰æ‹©ä»æœº)</p><ul><li>æ•°æ®åœ¨SCLKä¸Šå‡æ²¿é‡‡æ ·</li></ul><h3 id="åˆå§‹åŒ–æ­¥éª¤ï¼š-1"><a href="#åˆå§‹åŒ–æ­¥éª¤ï¼š-1" class="headerlink" title="åˆå§‹åŒ–æ­¥éª¤ï¼š"></a>åˆå§‹åŒ–æ­¥éª¤ï¼š</h3><ol><li>é…ç½®MISO&#x2F;MOSI&#x2F;SCLK&#x2F;SSå¼•è„š  </li><li>è®¾ç½®CPOLã€CPHAã€æ•°æ®ä½æ•°å’Œé€Ÿç‡  </li><li>å®šä¹‰ä¸»&#x2F;ä»æ¨¡å¼</li></ol><hr><h2 id="3-UARTé€šä¿¡"><a href="#3-UARTé€šä¿¡" class="headerlink" title="3. UARTé€šä¿¡"></a>3. <strong>UARTé€šä¿¡</strong></h2><h3 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul><li><strong>å¼‚æ­¥é€šä¿¡</strong>  </li><li><strong>ä¸¤æ ¹çº¿</strong>ï¼šTXï¼ˆå‘é€ï¼‰å’ŒRXï¼ˆæ¥æ”¶ï¼‰  </li><li><strong>é€Ÿç‡</strong>ï¼šå¸¸è§9600bps~115200bps</li></ul><h3 id="é€šä¿¡æ—¶åºï¼š-2"><a href="#é€šä¿¡æ—¶åºï¼š-2" class="headerlink" title="é€šä¿¡æ—¶åºï¼š"></a>é€šä¿¡æ—¶åºï¼š</h3><ol><li><strong>èµ·å§‹ä½</strong>ï¼šTXä»é«˜ç”µå¹³æ‹‰ä½  </li><li><strong>æ•°æ®ä½</strong>ï¼šä¼ è¾“8ä½æ•°æ®ï¼ˆLSBä¼˜å…ˆï¼‰  </li><li><strong>åœæ­¢ä½</strong>ï¼šTXæ¢å¤é«˜ç”µå¹³</li></ol><h4 id="æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12ï¼‰ï¼š"><a href="#æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12ï¼‰ï¼š" class="headerlink" title="æ—¶åºç¤ºä¾‹ï¼ˆå‘é€0x12ï¼‰ï¼š"></a>æ—¶åºç¤ºä¾‹ï¼ˆå‘é€<code>0x12</code>ï¼‰ï¼š</h4><p>æ—¶é—´  0   1   2   3   4   5   6   7   8   9   10  11<br>TX    â†“  1   0   0   0   1   0   0   1   0   1   â†‘ (åœæ­¢ä½)</p><ul><li>èµ·å§‹ä½ï¼ˆä½ï¼‰â†’ æ•°æ®ä½ï¼ˆ<code>0x12</code>&#x3D; <code>00010010</code>ï¼‰â†’ åœæ­¢ä½ï¼ˆé«˜ï¼‰</li></ul><h3 id="åˆå§‹åŒ–æ­¥éª¤ï¼š-2"><a href="#åˆå§‹åŒ–æ­¥éª¤ï¼š-2" class="headerlink" title="åˆå§‹åŒ–æ­¥éª¤ï¼š"></a>åˆå§‹åŒ–æ­¥éª¤ï¼š</h3><ol><li>é…ç½®TX&#x2F;RXå¼•è„š  </li><li>è®¾ç½®æ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€æ ¡éªŒä½å’Œåœæ­¢ä½</li></ol><hr><h2 id="4-å¯¹æ¯”æ€»ç»“"><a href="#4-å¯¹æ¯”æ€»ç»“" class="headerlink" title="4. å¯¹æ¯”æ€»ç»“"></a>4. <strong>å¯¹æ¯”æ€»ç»“</strong></h2><table><thead><tr><th>ç‰¹æ€§</th><th>I2C</th><th>SPI</th><th>UART</th></tr></thead><tbody><tr><td><strong>çº¿æ•°</strong></td><td>2ï¼ˆSDA, SCLï¼‰</td><td>4ï¼ˆMISO, MOSI, SCLK, SSï¼‰</td><td>2ï¼ˆTX, RXï¼‰</td></tr><tr><td><strong>æ¨¡å¼</strong></td><td>å¤šä¸»å¤šä»</td><td>ä¸»ä»å…¨åŒå·¥</td><td>å¼‚æ­¥ç‚¹å¯¹ç‚¹</td></tr><tr><td><strong>é€Ÿç‡</strong></td><td>100kbps~3.4Mbps</td><td>å‡ Mbps</td><td>9600bps~115200bps</td></tr><tr><td><strong>åº”ç”¨</strong></td><td>ä½é€Ÿå¤šè®¾å¤‡ï¼ˆå¦‚ä¼ æ„Ÿå™¨ï¼‰</td><td>é«˜é€ŸçŸ­è·ï¼ˆå¦‚Flashå­˜å‚¨å™¨ï¼‰</td><td>é•¿è·å¼‚æ­¥é€šä¿¡ï¼ˆå¦‚è°ƒè¯•å£ï¼‰</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>[object Object]</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è£¸æœºå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é˜»å¡I/Oç¬”è®°</title>
    <link href="/2025/04/15/20250415/"/>
    <url>/2025/04/15/20250415/</url>
    
    <content type="html"><![CDATA[<h1 id="âœ…-Linux-é©±åŠ¨ä¸­é˜»å¡-I-O-å®Œæ•´æµç¨‹æ€»ç»“"><a href="#âœ…-Linux-é©±åŠ¨ä¸­é˜»å¡-I-O-å®Œæ•´æµç¨‹æ€»ç»“" class="headerlink" title="âœ… Linux é©±åŠ¨ä¸­é˜»å¡ I&#x2F;O å®Œæ•´æµç¨‹æ€»ç»“"></a>âœ… Linux é©±åŠ¨ä¸­é˜»å¡ I&#x2F;O å®Œæ•´æµç¨‹æ€»ç»“</h1><hr><h2 id="ğŸ“Œ-é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—ï¼ˆè®¾å¤‡åˆå§‹åŒ–æ—¶ï¼‰"><a href="#ğŸ“Œ-é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—ï¼ˆè®¾å¤‡åˆå§‹åŒ–æ—¶ï¼‰" class="headerlink" title="ğŸ“Œ é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—ï¼ˆè®¾å¤‡åˆå§‹åŒ–æ—¶ï¼‰"></a>ğŸ“Œ é˜¶æ®µä¸€ï¼šåˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—ï¼ˆè®¾å¤‡åˆå§‹åŒ–æ—¶ï¼‰</h2><p><strong>ç›®çš„ï¼š</strong> å‡†å¤‡ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œç”¨äºåç»­è®©è¿›ç¨‹æŒ‚èµ·&#x2F;å”¤é†’</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">wait_queue_head_t</span> r_wait;               <span class="hljs-comment">// å£°æ˜ç­‰å¾…é˜Ÿåˆ—å¤´</span><br>init_waitqueue_head(&amp;r_wait);           <span class="hljs-comment">// åˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—</span><br></code></pre></td></tr></table></figure><hr><h2 id="ğŸ“Œ-é˜¶æ®µäºŒï¼šç”¨æˆ·è°ƒç”¨-read-ï¼Œé©±åŠ¨å¼€å§‹æ‰§è¡Œé˜»å¡æµç¨‹"><a href="#ğŸ“Œ-é˜¶æ®µäºŒï¼šç”¨æˆ·è°ƒç”¨-read-ï¼Œé©±åŠ¨å¼€å§‹æ‰§è¡Œé˜»å¡æµç¨‹" class="headerlink" title="ğŸ“Œ é˜¶æ®µäºŒï¼šç”¨æˆ·è°ƒç”¨ read()ï¼Œé©±åŠ¨å¼€å§‹æ‰§è¡Œé˜»å¡æµç¨‹"></a>ğŸ“Œ é˜¶æ®µäºŒï¼šç”¨æˆ·è°ƒç”¨ <code>read()</code>ï¼Œé©±åŠ¨å¼€å§‹æ‰§è¡Œé˜»å¡æµç¨‹</h2><p><strong>ç›®çš„ï¼š</strong> å¦‚æœå½“å‰è®¾å¤‡æ²¡æœ‰å‡†å¤‡å¥½æ•°æ®ï¼Œè®©å½“å‰è¿›ç¨‹é˜»å¡</p><h3 id="ğŸ”¹-åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡"><a href="#ğŸ”¹-åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡" class="headerlink" title="ğŸ”¹ åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡"></a>ğŸ”¹ åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (<span class="hljs-type">atomic_read</span>(&amp;releasekey) == <span class="hljs-number">0</span>)      <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰äº‹ä»¶ï¼ˆæ•°æ®ï¼‰å¯è¯»</span><br></code></pre></td></tr></table></figure><h3 id="ğŸ”¹-åˆ›å»ºç­‰å¾…é˜Ÿåˆ—é¡¹ï¼ˆç»‘å®šå½“å‰è¿›ç¨‹ï¼‰"><a href="#ğŸ”¹-åˆ›å»ºç­‰å¾…é˜Ÿåˆ—é¡¹ï¼ˆç»‘å®šå½“å‰è¿›ç¨‹ï¼‰" class="headerlink" title="ğŸ”¹ åˆ›å»ºç­‰å¾…é˜Ÿåˆ—é¡¹ï¼ˆç»‘å®šå½“å‰è¿›ç¨‹ï¼‰"></a>ğŸ”¹ åˆ›å»ºç­‰å¾…é˜Ÿåˆ—é¡¹ï¼ˆç»‘å®šå½“å‰è¿›ç¨‹ï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">DECLARE_WAITQUEUE(wait, current);       <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—èŠ‚ç‚¹ï¼ŒæŒ‡å‘å½“å‰è¿›ç¨‹</span><br>add_wait_queue(&amp;r_wait, &amp;wait);         <span class="hljs-comment">// å°†è¯¥èŠ‚ç‚¹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­</span><br></code></pre></td></tr></table></figure><h3 id="ğŸ”¹-è®¾ç½®å½“å‰ä»»åŠ¡çŠ¶æ€ä¸ºâ€œå¯ä¸­æ–­ç¡çœ â€"><a href="#ğŸ”¹-è®¾ç½®å½“å‰ä»»åŠ¡çŠ¶æ€ä¸ºâ€œå¯ä¸­æ–­ç¡çœ â€" class="headerlink" title="ğŸ”¹ è®¾ç½®å½“å‰ä»»åŠ¡çŠ¶æ€ä¸ºâ€œå¯ä¸­æ–­ç¡çœ â€"></a>ğŸ”¹ è®¾ç½®å½“å‰ä»»åŠ¡çŠ¶æ€ä¸ºâ€œå¯ä¸­æ–­ç¡çœ â€</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">__set_current_state(TASK_INTERRUPTIBLE); <span class="hljs-comment">// è¡¨ç¤ºæ„¿æ„è¿›å…¥ç¡çœ çŠ¶æ€</span><br></code></pre></td></tr></table></figure><h3 id="ğŸ”¹-çœŸæ­£è¿›å…¥é˜»å¡ï¼Œæ”¾å¼ƒ-CPU-æ§åˆ¶æƒ"><a href="#ğŸ”¹-çœŸæ­£è¿›å…¥é˜»å¡ï¼Œæ”¾å¼ƒ-CPU-æ§åˆ¶æƒ" class="headerlink" title="ğŸ”¹ çœŸæ­£è¿›å…¥é˜»å¡ï¼Œæ”¾å¼ƒ CPU æ§åˆ¶æƒ"></a>ğŸ”¹ çœŸæ­£è¿›å…¥é˜»å¡ï¼Œæ”¾å¼ƒ CPU æ§åˆ¶æƒ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">schedule();                              <span class="hljs-comment">// è¿›ç¨‹æŒ‚èµ·ï¼Œç›´åˆ°è¢«å”¤é†’ï¼ˆé˜»å¡ç‚¹ï¼‰</span><br></code></pre></td></tr></table></figure><hr><h2 id="ğŸ“Œ-é˜¶æ®µä¸‰ï¼šå¤–éƒ¨äº‹ä»¶å‘ç”Ÿï¼Œé©±åŠ¨å‡†å¤‡å”¤é†’é˜»å¡è¿›ç¨‹"><a href="#ğŸ“Œ-é˜¶æ®µä¸‰ï¼šå¤–éƒ¨äº‹ä»¶å‘ç”Ÿï¼Œé©±åŠ¨å‡†å¤‡å”¤é†’é˜»å¡è¿›ç¨‹" class="headerlink" title="ğŸ“Œ é˜¶æ®µä¸‰ï¼šå¤–éƒ¨äº‹ä»¶å‘ç”Ÿï¼Œé©±åŠ¨å‡†å¤‡å”¤é†’é˜»å¡è¿›ç¨‹"></a>ğŸ“Œ é˜¶æ®µä¸‰ï¼šå¤–éƒ¨äº‹ä»¶å‘ç”Ÿï¼Œé©±åŠ¨å‡†å¤‡å”¤é†’é˜»å¡è¿›ç¨‹</h2><p><strong>ç›®çš„ï¼š</strong> åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å”¤é†’ä¹‹å‰é˜»å¡çš„ <code>read()</code></p><h3 id="ğŸ”¹-å¤–éƒ¨ä¸­æ–­è§¦å‘ï¼ˆå¦‚æŒ‰é”®ä¸­æ–­ï¼‰"><a href="#ğŸ”¹-å¤–éƒ¨ä¸­æ–­è§¦å‘ï¼ˆå¦‚æŒ‰é”®ä¸­æ–­ï¼‰" class="headerlink" title="ğŸ”¹ å¤–éƒ¨ä¸­æ–­è§¦å‘ï¼ˆå¦‚æŒ‰é”®ä¸­æ–­ï¼‰"></a>ğŸ”¹ å¤–éƒ¨ä¸­æ–­è§¦å‘ï¼ˆå¦‚æŒ‰é”®ä¸­æ–­ï¼‰</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">irqreturn_t</span> <span class="hljs-title function_">key0_handler</span><span class="hljs-params">(<span class="hljs-type">int</span> irq, <span class="hljs-type">void</span> *dev_id)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">imx6uirq_dev</span> *<span class="hljs-title">dev</span> =</span> (<span class="hljs-keyword">struct</span> imx6uirq_dev *)dev_id;<br>    dev-&gt;curkeynum = <span class="hljs-number">0</span>;<br>    dev-&gt;timer.data = (<span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span>)dev_id;<br>    mod_timer(&amp;dev-&gt;timer, jiffies + msecs_to_jiffies(<span class="hljs-number">10</span>));<br>    <span class="hljs-keyword">return</span> IRQ_HANDLED;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ğŸ”¹-å®šæ—¶å™¨è¶…æ—¶ï¼Œè¿›å…¥å›è°ƒå‡½æ•°"><a href="#ğŸ”¹-å®šæ—¶å™¨è¶…æ—¶ï¼Œè¿›å…¥å›è°ƒå‡½æ•°" class="headerlink" title="ğŸ”¹ å®šæ—¶å™¨è¶…æ—¶ï¼Œè¿›å…¥å›è°ƒå‡½æ•°"></a>ğŸ”¹ å®šæ—¶å™¨è¶…æ—¶ï¼Œè¿›å…¥å›è°ƒå‡½æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">timer_function</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">imx6uirq_dev</span> *<span class="hljs-title">dev</span> =</span> (<span class="hljs-keyword">struct</span> imx6uirq_dev *)arg;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">irq_keydesc</span> *<span class="hljs-title">keydesc</span> =</span> &amp;dev-&gt;irqkeydesc[dev-&gt;curkeynum];<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> value = gpio_get_value(keydesc-&gt;gpio);<br><br>    <span class="hljs-keyword">if</span> (value == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">atomic_set</span>(&amp;dev-&gt;keyvalue, keydesc-&gt;value2);  <span class="hljs-comment">// æŒ‰ä¸‹</span><br>        <span class="hljs-type">atomic_set</span>(&amp;dev-&gt;releasekey, <span class="hljs-number">2</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">atomic_set</span>(&amp;dev-&gt;keyvalue, <span class="hljs-number">0x80</span> | keydesc-&gt;value);  <span class="hljs-comment">// é‡Šæ”¾</span><br>        <span class="hljs-type">atomic_set</span>(&amp;dev-&gt;releasekey, <span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-type">atomic_read</span>(&amp;dev-&gt;releasekey)) &#123;<br>        wake_up_interruptible(&amp;dev-&gt;r_wait);  <span class="hljs-comment">// å”¤é†’ç­‰å¾…é˜Ÿåˆ—</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="ğŸ“Œ-é˜¶æ®µå››ï¼šread-è¢«å”¤é†’åï¼Œæ¢å¤æ‰§è¡Œå¹¶è¯»å–æ•°æ®"><a href="#ğŸ“Œ-é˜¶æ®µå››ï¼šread-è¢«å”¤é†’åï¼Œæ¢å¤æ‰§è¡Œå¹¶è¯»å–æ•°æ®" class="headerlink" title="ğŸ“Œ é˜¶æ®µå››ï¼šread()è¢«å”¤é†’åï¼Œæ¢å¤æ‰§è¡Œå¹¶è¯»å–æ•°æ®"></a>ğŸ“Œ é˜¶æ®µå››ï¼š<code>read()</code>è¢«å”¤é†’åï¼Œæ¢å¤æ‰§è¡Œå¹¶è¯»å–æ•°æ®</h2><p><strong>ç›®çš„ï¼š</strong> è¢«å”¤é†’åå®Œæˆæ•°æ®è¯»å–å¹¶è¿”å›ç”¨æˆ·ç©ºé—´</p><h3 id="ğŸ”¹-è¢«å”¤é†’-â†’-åˆ¤æ–­æ˜¯å¦æ˜¯ä¿¡å·ä¸­æ–­"><a href="#ğŸ”¹-è¢«å”¤é†’-â†’-åˆ¤æ–­æ˜¯å¦æ˜¯ä¿¡å·ä¸­æ–­" class="headerlink" title="ğŸ”¹ è¢«å”¤é†’ â†’ åˆ¤æ–­æ˜¯å¦æ˜¯ä¿¡å·ä¸­æ–­"></a>ğŸ”¹ è¢«å”¤é†’ â†’ åˆ¤æ–­æ˜¯å¦æ˜¯ä¿¡å·ä¸­æ–­</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> (signal_pending(current)) &#123;<br>    ret = -ERESTARTSYS;<br>    <span class="hljs-keyword">goto</span> wait_error;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ğŸ”¹-æ¢å¤è¿›ç¨‹çŠ¶æ€-â†’-ä»ç¡çœ çŠ¶æ€è½¬ä¸ºè¿è¡Œ"><a href="#ğŸ”¹-æ¢å¤è¿›ç¨‹çŠ¶æ€-â†’-ä»ç¡çœ çŠ¶æ€è½¬ä¸ºè¿è¡Œ" class="headerlink" title="ğŸ”¹ æ¢å¤è¿›ç¨‹çŠ¶æ€ â†’ ä»ç¡çœ çŠ¶æ€è½¬ä¸ºè¿è¡Œ"></a>ğŸ”¹ æ¢å¤è¿›ç¨‹çŠ¶æ€ â†’ ä»ç¡çœ çŠ¶æ€è½¬ä¸ºè¿è¡Œ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">__set_current_state(TASK_RUNNING);<br>remove_wait_queue(&amp;r_wait, &amp;wait);<br></code></pre></td></tr></table></figure><h3 id="ğŸ”¹-æ‹·è´æ•°æ®è¿”å›ç»™ç”¨æˆ·"><a href="#ğŸ”¹-æ‹·è´æ•°æ®è¿”å›ç»™ç”¨æˆ·" class="headerlink" title="ğŸ”¹ æ‹·è´æ•°æ®è¿”å›ç»™ç”¨æˆ·"></a>ğŸ”¹ æ‹·è´æ•°æ®è¿”å›ç»™ç”¨æˆ·</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c">keyvalue = <span class="hljs-type">atomic_read</span>(&amp;dev-&gt;keyvalue);<br>releasekey = <span class="hljs-type">atomic_read</span>(&amp;dev-&gt;releasekey);<br><br><span class="hljs-keyword">if</span> (releasekey == <span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">if</span> (keyvalue &amp; <span class="hljs-number">0x80</span>) &#123;<br>        keyvalue &amp;= ~<span class="hljs-number">0x80</span>;<br>        ret = copy_to_user(buf, &amp;keyvalue, <span class="hljs-keyword">sizeof</span>(keyvalue));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">goto</span> data_error;<br>    &#125;<br>    <span class="hljs-type">atomic_set</span>(&amp;dev-&gt;releasekey, <span class="hljs-number">0</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (releasekey == <span class="hljs-number">2</span>) &#123;<br>    ret = copy_to_user(buf, &amp;keyvalue, <span class="hljs-keyword">sizeof</span>(keyvalue));<br>    <span class="hljs-type">atomic_set</span>(&amp;dev-&gt;releasekey, <span class="hljs-number">0</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">goto</span> data_error;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="âœ…-è¡¥å……æ¦‚å¿µè¯´æ˜ï¼ˆç®€æ´ç‰ˆï¼‰"><a href="#âœ…-è¡¥å……æ¦‚å¿µè¯´æ˜ï¼ˆç®€æ´ç‰ˆï¼‰" class="headerlink" title="âœ… è¡¥å……æ¦‚å¿µè¯´æ˜ï¼ˆç®€æ´ç‰ˆï¼‰"></a>âœ… è¡¥å……æ¦‚å¿µè¯´æ˜ï¼ˆç®€æ´ç‰ˆï¼‰</h2><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>wait_queue_head_t</code></td><td>ç­‰å¾…é˜Ÿåˆ—å¤´ï¼Œç®¡ç†ä¸€æ‰¹é˜»å¡ä»»åŠ¡</td></tr><tr><td><code>DECLARE_WAITQUEUE()</code></td><td>åˆ›å»ºç­‰å¾…é˜Ÿåˆ—èŠ‚ç‚¹ï¼ŒæŒ‡å‘å½“å‰è¿›ç¨‹ï¼ˆ<code>current</code>ï¼‰</td></tr><tr><td><code>add_wait_queue()</code></td><td>æŠŠèŠ‚ç‚¹æŒ‚åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸Š</td></tr><tr><td><code>__set_current_state()</code></td><td>è®¾ç½®å½“å‰è¿›ç¨‹çŠ¶æ€ä¸º <code>TASK_INTERRUPTIBLE</code> ç­‰å¾…å”¤é†’</td></tr><tr><td><code>schedule()</code></td><td>é˜»å¡å½“å‰ä»»åŠ¡ï¼Œè¿›å…¥ç¡çœ ï¼Œç­‰å¾…è¢«å”¤é†’</td></tr><tr><td><code>wake_up_interruptible()</code></td><td>å”¤é†’é˜Ÿåˆ—ä¸­æ‰€æœ‰å¤„äºâ€œå¯ä¸­æ–­ç¡çœ â€çš„ä»»åŠ¡</td></tr></tbody></table><hr><h2 id="âœ…-ä¸€å¥è¯æ€»ç»“æµç¨‹"><a href="#âœ…-ä¸€å¥è¯æ€»ç»“æµç¨‹" class="headerlink" title="âœ… ä¸€å¥è¯æ€»ç»“æµç¨‹"></a>âœ… ä¸€å¥è¯æ€»ç»“æµç¨‹</h2><blockquote><p>ç”¨æˆ·æ€è°ƒç”¨ <code>read()</code> â†’ é©±åŠ¨è¿›å…¥é˜»å¡ â†’ å¤–éƒ¨ä¸­æ–­è§¦å‘å®šæ—¶å™¨ â†’ å®šæ—¶å™¨ä¸­å”¤é†’ä»»åŠ¡ â†’ <code>read()</code> æ¢å¤æ‰§è¡Œï¼Œè¿”å›æŒ‰é”®å€¼ã€‚<br>&#96;&#96;&#96;</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>[object Object]</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2025/04/15/hello-world/"/>
    <url>/2025/04/15/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
